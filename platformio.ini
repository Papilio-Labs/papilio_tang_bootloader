; PlatformIO Project Configuration File
;
; Papilio RetroCade - ESP32-S3 + Gowin FPGA Dual-Target Build
; 
; This project supports building both ESP32-S3 firmware and Gowin FPGA gateware
; in a single unified workflow. The FPGA bitstream is automatically built after
; the ESP32 firmware compilation completes.
;
; For more information: https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp32, fpga

; ==============================================================================
; ESP32-S3 Firmware Build
; ==============================================================================
[env:esp32]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
build_type = debug
board_build.arduino.memory_type = qio_qspi
board_build.flash_mode = qio
board_build.psram_type = qio
board_upload.flash_size = 4MB
board_upload.maximum_size = 4194304
board_build.partitions = default.csv

build_flags = -I include
              -DARDUINO_USB_CDC_ON_BOOT=1
              -DBOARD_HAS_PSRAM

board_build.filesystem = littlefs

; Serial monitor configuration
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder

; Library dependencies
lib_deps = 
    ; fastled/FastLED@^3.9.4

; ==============================================================================
; FPGA Gateware Build
; ==============================================================================
[env:fpga]
platform = https://github.com/Papilio-Labs/platform-gowin.git
board = papilio_retrocade_fpga
framework = hdl

; Setup multi-boot configuration
board_build.multi_boot = 1
board_build.spi_flash_address = 00100000

; Dual-purpose pin configuration
; Uncomment to use dedicated pins as regular I/O
; board_build.use_sspi_as_gpio = 1
board_build.use_mspi_as_gpio = 1
; board_build.use_jtag_as_gpio = 1  ; WARNING: Can brick your board! Only enable if you have alternative programming method
; board_build.use_ready_as_gpio = 1
; board_build.use_done_as_gpio = 1

; FPGA-specific configuration
board_build.fpga_project = fpga/project.gprj

; Upload protocol for FPGA
upload_protocol = pesptool